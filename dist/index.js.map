{"mappings":"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","sources":["src/index.js","src/ModalControlElement.js","src/ModalController.js","src/deepContains.js","src/isEventInsideElement.js"],"sourcesContent":["import ModalControlElement from './ModalControlElement.js';\nimport ModalController from './ModalController.js';\n\n/**\n * @param {string} [name]\n * @returns {void}\n */\nconst define = (name = 'modal-control') => {\n  if ('customElements' in window) {\n    customElements.define(name, ModalControlElement);\n  }\n};\n\nexport { ModalControlElement, ModalController, define };\n","import ModalController from \"./ModalController.js\";\n\n/**\n * @customElement modal-control\n * @attr target - ID of the target `<dialog>`\n * @attr {'toggle'|'show'|'hide'} target-action - What should happen to the dialog when clicking the control (default: 'toggle')\n * @attr light-dismiss - If present, the modal will be closeable by clicking outside of it\n * @fires modal-control-before-toggle\n * @fires modal-control-toggle\n */\nexport default class ModalControlElement extends HTMLElement {\n  /** @type {string | null} */\n  #target = null;\n  /** @type {'toggle' | 'show' | 'hide'} */\n  #targetAction = 'toggle';\n  /** @type {boolean} */\n  #lightDismiss = false;\n  /** @type {ModalController | undefined} */\n  #controller;\n\n  static observedAttributes = ['target', 'target-action', 'light-dismiss'];\n\n  /**\n   * @param {string}  name\n   * @param {string | undefined}     _oldVal\n   * @param {string | undefined}     newVal\n   */\n  attributeChangedCallback(name, _oldVal, newVal) {\n    if (name === 'target') {\n      this.#target = newVal || null;\n    }\n\n    if (\n      name === 'target-action' &&\n      newVal &&\n      ['toggle', 'show', 'hide'].includes(newVal)\n    ) {\n      this.#targetAction = /** @type {'toggle' | 'show' | 'hide'} */ (newVal);\n    }\n\n    if (name === 'light-dismiss') {\n      this.#lightDismiss = newVal !== undefined;\n    }\n\n    if (name === 'target' || name === 'light-dismiss') {\n      this.#initController();\n    }\n  }\n\n  /**\n   * ID of the target `<dialog>`\n   * @type {string|null}\n   */\n  get target() {\n    return this.#target;\n  }\n\n  set target(value) {\n    this.#target = value;\n\n    if (value === null) {\n      this.removeAttribute('target');\n    } else {\n      this.setAttribute('target', value);\n    }\n  }\n\n  /**\n   * What should happen to the dialog when clicking the control (default: 'toggle')\n   * @type {'toggle'|'show'|'hide'}\n   */\n  get targetAction() {\n    return this.#targetAction;\n  }\n\n  set targetAction(value) {\n    if (!value) {\n      return;\n    }\n\n    this.#targetAction = value;\n\n    if (value === null) {\n      this.removeAttribute('target-action');\n    } else {\n      this.setAttribute('target-action', value);\n    }\n  }\n\n  /**\n   * Determines how the user can close the target modal\n   * @type {boolean}\n   */\n  get lightDismiss() {\n    return this.#lightDismiss;\n  }\n\n  set lightDismiss(value) {\n    this.#lightDismiss = Boolean(value);\n\n    if (this.#lightDismiss) {\n      this.setAttribute('light-dismiss', '');\n    } else {\n      this.removeAttribute('light-dismiss');\n    }\n  }\n\n  /** @type {HTMLDialogElement|null} */\n  get targetElement() {\n    const root = /** @type {Document|ShadowRoot} */ (this.getRootNode());\n    const el = this.target ? root.getElementById(this.target) : null;\n\n    if (!(el instanceof HTMLDialogElement)) {\n      return null;\n    }\n\n    return el;\n  }\n\n  connectedCallback() {\n    this.addEventListener('click', this.#handleClick);\n    this.#initController();\n  }\n\n  disconnectedCallback() {\n    this.removeEventListener('click', this.#handleClick);\n  }\n\n  #initController() {\n    const root = this.getRootNode();\n\n    if (root instanceof Document || root instanceof ShadowRoot) {\n      this.#controller = new ModalController(() => this.targetElement, {\n        lightDismiss: this.#lightDismiss,\n        canToggle: () => this.#dispatchBeforeToggle(),\n        onToggle: () => this.#dispatchToggle(),\n      });\n    }\n  }\n\n  /** @returns {boolean} */\n  #dispatchBeforeToggle() {\n    return this.dispatchEvent(\n      new Event('modal-control-before-toggle', { cancelable: true })\n    );\n  }\n\n  /** @returns {boolean} */\n  #dispatchToggle() {\n    return this.dispatchEvent(new Event('modal-control-toggle'));\n  }\n\n  /**\n   * @param {MouseEvent} event\n   * @returns {void}\n   */\n  #handleClick = event => {\n    const target = /** @type {Element} */ (event.target);\n\n    if (!target.closest('button, input[type=\"button\"]')) {\n      return;\n    }\n\n    switch (this.targetAction) {\n      case 'show':\n        this.#controller?.show();\n        break;\n      case 'hide':\n        this.#controller?.hide();\n        break;\n      case 'toggle':\n        this.#controller?.toggle();\n        break;\n    }\n  };\n}\n","import { deepContains } from \"./deepContains.js\";\nimport isEventInsideElement from \"./isEventInsideElement.js\";\n\n/**\n * @typedef {{\n *   lightDismiss?: boolean;\n *   canToggle?: () => boolean;\n *   onToggle?: () => void;\n * }} ModalOptions\n */\n\nexport default class ModalController {\n  #dialogOrGetter;\n  #options;\n  \n  /**\n   * @param {HTMLDialogElement | (() => HTMLDialogElement?)} dialog Element or getter\n   * @param {ModalOptions} [options]\n   */\n  constructor(dialog, options) {\n    const defaultOptions = { canToggle: () => true };\n    this.#dialogOrGetter = dialog;\n    this.#options = Object.assign(defaultOptions, options);\n  }\n\n  show() {\n    const dialog = this.#getDialog();\n\n    if (!dialog || dialog.matches(':modal') || !this.#options.canToggle?.()) {\n      return;\n    }\n    \n    const abortController = new AbortController();\n    dialog.showModal();\n\n    if (this.#options.lightDismiss) {\n      dialog.addEventListener(\n        'click',\n        (event) => {\n          if (!(event instanceof MouseEvent) || isEventInsideElement(event, dialog)) {\n            return;\n          }\n\n          this.hide();\n        },\n        { signal: abortController.signal }\n      );\n\n      setTimeout(() => {\n        const root = dialog.getRootNode();\n        \n        /** @param {Event} event */\n        const handleClickDirectRoot = (event) => {\n          // If the click is inside the dialog, ignore it\n          if (!(event instanceof MouseEvent) || isEventInsideElement(event, dialog)) {\n            return;\n          }\n\n          this.hide();\n        };\n\n        if (root instanceof ShadowRoot) {\n          root.addEventListener(\n            'click',\n            handleClickDirectRoot,\n            { signal: abortController.signal }\n          );\n\n          dialog.getRootNode({ composed: true }).addEventListener(\n            'click',\n            (event) => {\n              // If the target is an ancestor of the dialog, ignore the click\n              // (the shadow click handler should take care of anything inside\n              // the target that's not the dialog)\n              if (!(event.target instanceof Node) || deepContains(event.target, dialog)) {\n                return;\n              }\n\n              this.hide();\n            },\n            { signal: abortController.signal }\n          );\n        } else {\n          root.addEventListener(\n            'click',\n            handleClickDirectRoot,\n            { signal: abortController.signal }\n          );\n        }\n\n        dialog.addEventListener(\n          'close',\n          () => abortController.abort(),\n          { signal: abortController.signal }\n        );\n      }, 0);\n    }\n\n    this.#options.onToggle?.();\n  }\n\n  hide() {\n    const dialog = this.#getDialog();\n\n    if (!dialog || dialog.matches(':not(:modal)') || !this.#options.canToggle?.()) {\n      return;\n    }\n\n    dialog.close();\n    this.#options.onToggle?.();\n  }\n\n  toggle() {\n    if (this.#getDialog()?.matches(':modal')) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  #getDialog() {\n    if (typeof this.#dialogOrGetter === 'function') {\n      return this.#dialogOrGetter();\n    }\n\n    return this.#dialogOrGetter;\n  }\n}\n","/**\n * Checks if an ancestor node contains a descendant node, crossing shadow\n * boundaries\n * @param {Node} ancestor\n * @param {Node} descendant\n */\nexport function deepContains(ancestor, descendant) {\n  // First, check via normal contains (fastest, but doesn't work with shadow\n  // roots)\n  if (ancestor.contains(descendant)) {\n    return true;\n  }\n\n  // This could be a shadow root or a document\n  const root = descendant.getRootNode();\n\n  if (root instanceof ShadowRoot) {\n    // Check the host of the shadow root\n    return deepContains(ancestor, root.host);\n  }\n\n  // If it's not a shadow root and contains() returned false, it's definitely\n  // not a match\n  return false;\n}\n","import { deepContains } from \"./deepContains.js\";\n\n/**\n * @param {MouseEvent}  event\n * @param {HTMLDialogElement} dialog\n * @returns {boolean}\n */\nexport default function isEventInsideElement(event, dialog) {\n  const { clientX, clientY } = event;\n  const target = /** @type {Node} */ (event.target);\n  const { x, y, width, height } = dialog.getBoundingClientRect();\n\n  // If the target IS the dialog, check that the event is inside the bounds. A\n  // click on the backdrop of a dialog will appear as a click on the dialog\n  // itself, but will be outside the bounds.\n  if (dialog === target) {\n    return (\n      clientX >= x &&\n      clientX <= x + width &&\n      clientY >= y &&\n      clientY <= y + height\n    );\n  }\n\n  // If the target isn't the dialog itself, check that it's inside the dialog\n  return deepContains(dialog, target);\n}"],"names":[],"version":3,"file":"index.js.map"}